---
vim: expandtab filetype=liquid
layout: default
version: 0.0.3
license: AGPL-3.0
author: S0AndS0
---
{% capture workspace__collection_home %}
  {% assign target_collection = site[page.collection_name] %}
  {% assign date_format = site[site.theme].date_format | default: "%b %-d, %Y" %}
  {% assign list_title = page.list_title | default: page.collection_name %}
  {% assign posts_sort_by = page.posts_sort_by | default: nil %}
  {% assign posts_reverse = page.posts_reverse | default: false %}
  {% assign list_title_id = list_title | slugify: "ascii" %}

  <div class="home">
    {% if page.title %}
      <h1 class="page-heading">{{ page.title }}</h1>
    {% endif %}

    {{ content }}

    {% comment %}
      Builds list of posts
    {% endcomment %}
    {% assign has_atom_feed = false %}
    {% assign has_rss_feed = false %}
    {% assign has_json_feed = false %}
    {% if target_collection.size > 0 %}{% comment %}<br> syntax highlighting  work-around #{% endcomment %}
      {% capture workspace__collection__list %}
        {% assign target_posts = '' | split: '' %}
        {% for file in target_collection %}
          {% if page.relative_path == file.relative_path %}
            {% continue %}
          {% elsif file.ext == '.xml' or file.ext == '.rss' %}
            {% assign has_rss_feed = true %}
            {% assign feed_rss_url = file.url %}
          {% elsif file.ext == '.atom' %}
            {% assign has_atom_feed = true %}
            {% assign feed_atom_url = file.url %}
          {% elsif file.ext == '.json' %}
            {% if file.slug == 'feed' or file.slug == page.collection_name %}
              {% assign has_json_feed = true %}
              {% assign feed_json_url = file.url %}
            {% endif %}
          {% else %}
            {% assign target_posts = target_posts | push: file %}
          {% endif %}
        {% endfor %}

        {% comment %}
          Transpile list of posts into HTML
        {% endcomment %}
        {% if target_posts.size %}
          {% if posts_sort_by.size > 0 %}
            {% assign target_posts = target_posts | sort: posts_sort_by %}
          {% endif %}

          {% if posts_reverse == true %}
            {% assign target_posts = target_posts | reverse %}
          {% endif %}

          <h2 class="post-list-heading" id="{{ list_title_id }}">{{ list_title }}</h2>
          <ul class="post-list">
            {% for post in target_posts %}
              <li>
                <span class="post-meta">{{ post.date | date: date_format }}</span>
                <h3>
                  <a class="post-link" href="{{ post.url | relative_url }}">
                    {{ post.title | escape }}
                  </a>
                </h3>
                {% if post.description %}
                  <blockquote>
                    {{ post.description | markdownify | remove: '<p>' | remove: '</p>' }}
                  </blockquote>
                {% elsif site.show_excerpts and post.excerpt %}
                  <blockquote>
                    {{ post.excerpt | markdownify | remove: '<p>' | remove: '</p>' }}
                  </blockquote>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endcapture %}


      {% comment %}
        Note for future _includes/header.html modifications

        <link
         rel="alternate"
         title="{{ page.collection_name }}"
         type="application/atom+xml"
         href="{{ page.collection_name | append: '/feed.atom' | relative_url }}"
        />
      {% endcomment %}


      {% comment %}
        Builds output for workspace__collection_home
      {% endcomment %}
      {% if target_posts.size %}
        {{ workspace__collection__list }}{% assign workspace__collection__list = nil %}

        {% if has_rss_feed or has_atom_feed or has_rss_feed %}
          <p class="feed-subscribe">
            {% if has_rss_feed %}
              <span>
                <svg class="svg-icon orange">
                  <use xlink:href="{{ '/assets/minima-social-icons.svg#rss' | relative_url }}"></use>
                </svg>
                <a href="{{ feed_rss_url | relative_url }}">RSSv2</a>
                {% assign feed_rss_url = nil %}
              </span>
            {% endif %}

            {% if has_atom_feed %}
              <span>
                {% if has_rss_feed != true %}
                  <svg class="svg-icon orange">
                    <use xlink:href="{{ '/assets/minima-social-icons.svg#rss' | relative_url }}"></use>
                  </svg>
                {% else %}
                  or
                {% endif %}
                <a href="{{ feed_atom_url | relative_url }}">Atom</a>
                {% assign feed_atom_url = nil %}
              </span>
            {% endif %}

            {% if has_json_feed %}
              <span>
                {% if has_rss_feed or has_atom_feed %}
                  or
                {% elsif has_rss_feed != true and has_atom_feed != true %}
                  <svg class="svg-icon orange">
                    <use xlink:href="{{ '/assets/minima-social-icons.svg#rss' | relative_url }}"></use>
                  </svg>
                {% endif %}
                <a href="{{ feed_json_url | relative_url }}">JSON</a>
                {% assign feed_json_url = nil %}
              </span>
            {% endif %}
          </p>
        {% endif %}

        {% assign target_posts = nil %}
      {% endif %}

    {% endif %}
  </div>
{% endcapture %}{{ workspace__collection_home | strip }}{% assign workspace__collection_home = nil %}
